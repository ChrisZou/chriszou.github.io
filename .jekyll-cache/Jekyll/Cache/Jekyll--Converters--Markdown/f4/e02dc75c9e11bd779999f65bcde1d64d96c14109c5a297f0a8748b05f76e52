I"³^<blockquote>
  <p>å‡ ç‚¹è¯´æ˜ï¼š</p>
  <ol>
    <li>ä»£ç ä¸­çš„ //&lt;== è¡¨ç¤ºè·Ÿä¸Šé¢çš„ç›¸æ¯”ï¼Œè¿™æ˜¯æ–°å¢çš„ï¼Œæˆ–è€…æ˜¯ä¿®æ”¹çš„ä»£ç ï¼Œä¸çŸ¥é“æ€ä¹ˆæ ·åœ¨ä»£ç å—é‡Œé¢å†å¼ºè°ƒå‡ è¡Œä»£ç T_Tã€‚ã€‚ã€‚</li>
    <li>å¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†é¿å…ä¸­æ–‡æ­§ä¹‰ï¼Œæˆ‘ä¼šç”¨è‹±æ–‡è¡¨è¿°</li>
  </ol>
</blockquote>

<p><a href="http://chriszou.com/2016/04/13/android-unit-testing-start-from-what.html">åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« é‡Œé¢</a>æˆ‘ä»¬æåˆ°ï¼Œè¿”å›ç±»å‹ä¸ºvoidæ–¹æ³•çš„å•å…ƒæµ‹è¯•æ–¹å¼ï¼Œå¾€å¾€æ˜¯éªŒè¯é‡Œé¢çš„æŸä¸ªå¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ˜¯å¦å¾—åˆ°äº†è°ƒç”¨ã€‚åœ¨é‚£ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä¸¾çš„ä¾‹å­æ˜¯activityé‡Œé¢çš„ä¸€ä¸ªloginæ–¹æ³•ï¼š</p>

<pre><code class="language-java">public void login() {
    String username = ...//get username from username EditText
    String password = ...//get password from password EditText
    //do other operation like validation, etc
    ...

    mUserManager.performLogin(username, password);
}
</code></pre>

<p>å¯¹äºè¿™ä¸ªloginæ–¹æ³•çš„å•å…ƒæµ‹è¯•ï¼Œåº”è¯¥æ˜¯è°ƒç”¨Activityé‡Œé¢çš„è¿™ä¸ªloginæ–¹æ³•ï¼Œç„¶åéªŒè¯<code>mUserManager</code>çš„<code>performLogin</code>æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨Activityï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°<a href="http://robolectric.org/">Robolectric</a>æ¡†æ¶ï¼Œç„¶è€Œæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰è®²åˆ°Robolectricçš„ä½¿ç”¨ã€‚æ‰€ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ®µä»£ç æ˜¯æ”¾åœ¨ä¸€ä¸ªPresenterï¼ˆLoginPresenterï¼‰é‡Œé¢çš„ï¼Œè¿™ä¸ªæ˜¯<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">MVPæ¨¡å¼</a>é‡Œé¢çš„æ¦‚å¿µï¼Œè¿™ä¸ª<code>LoginPresenter</code>æ˜¯ä¸€ä¸ªçº¯javaç±»ï¼Œè€Œç”¨æˆ·åå’Œå¯†ç æ˜¯å¤–é¢ä¼ è¿›æ¥çš„ï¼š</p>

<pre><code class="language-java">public class LoginPresenter {
    private UserManager mUserManager = new UserManager();

    public void login(String username, String password) {
        if (username == null || username.length() == 0) return;
        if (password == null || password.length() &lt; 6) return;

        mUserManager.performLogin(username, password);
    }

}
</code></pre>

<p>æ ¹æ®<a href="http://chriszou.com/2016/04/18/android-unit-testing-junit.html">å‰é¢ä¸€ç¯‡å…³äºJUnitçš„æ–‡ç« </a>çš„è®²è§£ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çš„å†™å‡ºé’ˆå¯¹<code>login()</code>æ–¹æ³•çš„å•å…ƒæµ‹è¯•ï¼š</p>

<pre><code class="language-java">public class LoginPresenterTest {

    @Test
    public void testLogin() throws Exception {
        LoginPresenter loginPresenter = new LoginPresenter();
        loginPresenter.login("xiaochuang", "xiaochuang password");

        //éªŒè¯LoginPresenteré‡Œé¢çš„mUserManagerçš„performLogin()æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼ŒåŒæ—¶å‚æ•°åˆ†åˆ«æ˜¯â€œxiaochuangâ€ã€â€œxiaochuang passwordâ€
        ...
    }
}
</code></pre>

<p>ç°åœ¨ï¼Œå…³é”®çš„é—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆéªŒè¯<code>LoginPresenter</code>é‡Œé¢çš„<code>mUserManager</code>çš„<code>performLogin()</code>æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼Œä»¥åŠå®ƒçš„å‚æ•°æ˜¯æ­£ç¡®æ€§å‘¢ï¼Ÿå¦‚æœå¤§å®¶çœ‹äº†<a href="http://chriszou.com/2016/04/13/android-unit-testing-start-from-what.html">è¯¥ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« </a>å°±çŸ¥é“ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°<a href="https://en.wikipedia.org/wiki/Mock_object">mock</a>ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»‹ç»mockè¿™ä¸ªä¸œè¥¿ã€‚</p>

<h3 id="mockçš„æ¦‚å¿µä¸¤ç§è¯¯è§£">Mockçš„æ¦‚å¿µï¼šä¸¤ç§è¯¯è§£</h3>
<p>Mockçš„æ¦‚å¿µï¼Œå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿä»‹ç»è¿‡ï¼šæ‰€è°“çš„mockå°±æ˜¯åˆ›å»ºä¸€ä¸ªç±»çš„è™šå‡çš„å¯¹è±¡ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œç”¨æ¥æ›¿æ¢æ‰çœŸå®çš„å¯¹è±¡ï¼Œä»¥è¾¾åˆ°ä¸¤å¤§ç›®çš„ï¼š</p>

<ol>
  <li>éªŒè¯è¿™ä¸ªå¯¹è±¡çš„æŸäº›æ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼Œè°ƒç”¨äº†å¤šå°‘æ¬¡ï¼Œå‚æ•°æ˜¯ä»€ä¹ˆç­‰ç­‰</li>
  <li>æŒ‡å®šè¿™ä¸ªå¯¹è±¡çš„æŸäº›æ–¹æ³•çš„è¡Œä¸ºï¼Œè¿”å›ç‰¹å®šçš„å€¼ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ</li>
</ol>

<p>è¦ä½¿ç”¨Mockï¼Œä¸€èˆ¬éœ€è¦ç”¨åˆ°mockæ¡†æ¶ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä½¿ç”¨<a href="http://mockito.org/">Mockito</a>è¿™ä¸ªæ¡†æ¶ï¼Œè¿™ä¸ªæ˜¯Javaç•Œä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ä¸ªmockæ¡†æ¶ã€‚</p>

<p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¦éªŒè¯<code>mUserManager</code>çš„ä¸€äº›è¡Œä¸ºï¼Œé¦–å…ˆè¦mock UserManagerè¿™ä¸ªç±»ï¼Œmockè¿™ä¸ªç±»çš„æ–¹å¼æ˜¯ï¼š<br />
<code>Mockito.mock(UserManager.class);</code><br />
mockäº†<code>UserManager</code>ç±»ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼š</p>

<pre><code class="language-java">public class LoginPresenterTest {

    @Test
    public void testLogin() {
        Mockito.mock(UserManager.class);    //&lt;==
        LoginPresenter loginPresenter = new LoginPresenter();
        loginPresenter.login("xiaochuang", "xiaochuang password");

        //éªŒè¯LoginPresenteré‡Œé¢çš„mUserManagerçš„performLogin()æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼Œå‚æ•°åˆ†åˆ«æ˜¯â€œxiaochuangâ€ã€â€œxiaochuang passwordâ€
        ...
    }
}
</code></pre>

<p>ç„¶è€Œæˆ‘ä»¬è¦éªŒè¯çš„æ˜¯<code>LoginPresenter</code>é‡Œé¢çš„<code>mUserManager</code>è¿™ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ²¡æœ‰åŠæ³•è·å¾—è¿™ä¸ªå¯¹è±¡ï¼Œå› ä¸º<code>mUserManager</code>æ˜¯privateçš„ï¼Œæ€ä¹ˆåŠï¼Ÿå…ˆä¸æƒ³å¤ªå¤šï¼Œæˆ‘ä»¬ç®€å•ç²—æš´ç‚¹ï¼Œç»™<code>LoginPresenter</code>åŠ ä¸€ä¸ªgetterï¼Œç¨åä½ ä¼šæ˜ç™½æˆ‘ç°åœ¨ä¸ºä»€ä¹ˆåšè¿™æ ·çš„å†³å®šã€‚</p>

<pre><code class="language-java">public class LoginPresenter {
    private UserManager mUserManager = new UserManager();

    public void login(String username, String password) {
        if (username == null || username.length() == 0) return;
        if (password == null || password.length() &lt; 6) return;

        mUserManager.performLogin(username, password);
    }

    public UserManager getUserManager() {   //&lt;==
        return mUserManager;
    }
}
</code></pre>

<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥éªŒè¯<code>mUserManager</code>è¢«è°ƒç”¨çš„æƒ…å†µäº†ï¼š</p>

<pre><code class="language-java">public class LoginPresenterTest {

    @Test
    public void testLogin() throws Exception {
        Mockito.mock(UserManager.class);
        LoginPresenter loginPresenter = new LoginPresenter();
        loginPresenter.login("xiaochuang", "xiaochuang password");

        UserManager userManager = loginPresenter.getUserManager();  //&lt;==
        //éªŒè¯userManagerçš„performLogin()æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼Œå‚æ•°åˆ†åˆ«æ˜¯â€œxiaochuangâ€ã€â€œxiaochuang passwordâ€
        ...
    }
}
</code></pre>

<p>ç»ˆäºåˆ°äº†è§£é‡Šå¦‚ä½•éªŒè¯ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æƒ…å†µäº†ã€‚ä½¿ç”¨Mockitoï¼ŒéªŒè¯ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æƒ…å†µçš„å§¿åŠ¿æ˜¯ï¼š<br />
<code>Mockito.verify(objectToVerify).methodToVerify(arguments);</code> <br />
å…¶ä¸­ï¼Œ<code>objectToVerify</code>å’Œ<code>methodToVerify</code>åˆ†åˆ«æ˜¯ä½ æƒ³è¦éªŒè¯çš„å¯¹è±¡å’Œæ–¹æ³•ã€‚å¯¹åº”ä¸Šé¢çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯ï¼š<br />
<code>Mockito.verify(userManager).performLogin("xiaochuang", "xiaochuang password");</code><br />
å¥½ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™è¡Œä»£ç æ”¾åˆ°æµ‹è¯•é‡Œé¢ï¼š</p>

<pre><code class="language-java">public class LoginPresenterTest {

    @Test
    public void testLogin() throws Exception {
        Mockito.mock(UserManager.class);
        LoginPresenter loginPresenter = new LoginPresenter();
        loginPresenter.login("xiaochuang", "xiaochuang password");

        UserManager userManager = loginPresenter.getUserManager();
        Mockito.verify(userManager).performLogin("xiaochuang", "xiaochuang password");  //&lt;==
    }
}
</code></pre>

<p>æ¥ç€æˆ‘ä»¬è·‘ä¸€ä¸‹è¿™ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œç»“æœå‘ç°ï¼Œé¢ã€‚ã€‚ã€‚å‡ºé”™äº†ï¼š</p>

<p><img src="http://7xod3k.com1.z0.glb.clouddn.com/yzltywhziscrrewgatwawldqtzpdqmwz" alt="" /></p>

<p>å…·ä½“å‡ºé”™çš„æ˜¯æœ€åè¿™ä¸€è¡Œä»£ç ï¼š<code>Mockito.verify(userManager).performLogin("xiaochuang", "xiaochuang password");</code>ã€‚è¿™ä¸ªé”™è¯¯çš„å¤§æ¦‚æ„æ€æ˜¯ï¼Œä¼ ç»™<code>Mockito.verify()</code>çš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªmockå¯¹è±¡ï¼Œè€Œæˆ‘ä»¬ä¼ è¿›å»çš„ä¸æ˜¯ä¸€ä¸ªmockå¯¹è±¡ï¼Œæ‰€ä»¥å‡ºé”™äº†ã€‚</p>

<p>è¿™å°±æ˜¯æˆ‘æƒ³è§£é‡Šçš„ï¼Œå…³äºmockçš„ç¬¬ä¸€ä¸ªè¯¯è§£ï¼š<strong><code>Mockito.mock()</code>å¹¶ä¸æ˜¯mockä¸€æ•´ä¸ªç±»ï¼Œè€Œæ˜¯æ ¹æ®ä¼ è¿›å»çš„ä¸€ä¸ªç±»ï¼Œmockå‡ºå±äºè¿™ä¸ªç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›è¿™ä¸ªmockå¯¹è±¡ï¼›è€Œä¼ è¿›å»çš„è¿™ä¸ªç±»æœ¬èº«å¹¶æ²¡æœ‰æ”¹å˜ï¼Œç”¨è¿™ä¸ªç±»newå‡ºæ¥çš„å¯¹è±¡ä¹Ÿæ²¡æœ‰å—åˆ°ä»»ä½•æ”¹å˜ï¼</strong></p>

<p>ç»“åˆä¸Šé¢çš„ä¾‹å­ï¼Œ<code>Mockito.mock(UserManager.class);</code>åªæ˜¯è¿”å›äº†ä¸€ä¸ªå±äº<code>UserManager</code>è¿™ä¸ªç±»çš„ä¸€ä¸ªmockå¯¹è±¡ã€‚<code>UserManager</code>è¿™ä¸ªç±»æœ¬èº«æ²¡æœ‰å—åˆ°ä»»ä½•å½±å“ï¼Œè€Œ<code>LoginPresenter</code>é‡Œé¢ç›´æ¥<code>new  UserManager()</code>å¾—åˆ°çš„<code>mUserManager</code>ä¹Ÿæ˜¯æ­£å¸¸çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯ä¸€ä¸ªmockå¯¹è±¡ã€‚<code>Mockito.verify()</code>çš„å‚æ•°å¿…é¡»æ˜¯mockå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒMockitoåªèƒ½éªŒè¯mockå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æƒ…å†µã€‚å› æ­¤ï¼Œä¸Šé¢é‚£ç§å†™æ³•å°±å‡ºé”™äº†ã€‚</p>

<p>å¥½çš„ï¼ŒçŸ¥é“äº†ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œçœ‹æ¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>Mockito.mock(UserManager.class);</code>è¿”å›çš„å¯¹è±¡æ¥éªŒè¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">public class LoginPresenterTest {

    @Test
    public void testLogin() throws Exception {
        UserManager mockUserManager = Mockito.mock(UserManager.class);  //&lt;==
        LoginPresenter loginPresenter = new LoginPresenter();

        loginPresenter.login("xiaochuang", "xiaochuang password");

        Mockito.verify(mockUserManager).performLogin("xiaochuang", "xiaochuang password");  //&lt;==
    }
}
</code></pre>

<p>åœ¨è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°ï¼Œé¢ã€‚ã€‚ã€‚åˆå‡ºé”™äº†ï¼š</p>

<p><img src="http://7xod3k.com1.z0.glb.clouddn.com/sdqjydxmgjyeurwmjhssgpogucdgzkmk" alt="" /></p>

<p>é”™è¯¯ä¿¡æ¯çš„å¤§æ„æ˜¯ï¼Œæˆ‘ä»¬æƒ³éªŒè¯<code>mockUserManager</code>çš„<code>performLogin()</code>æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼Œç„¶è€Œå…¶å®å¹¶æ²¡æœ‰ã€‚</p>

<p>è¿™å°±æ˜¯æˆ‘æƒ³è§£é‡Šçš„ï¼Œå…³äºmockçš„ç¬¬äºŒä¸ªè¯¯è§£ï¼š<strong>mockå‡ºæ¥çš„å¯¹è±¡å¹¶ä¸ä¼šè‡ªåŠ¨æ›¿æ¢æ‰æ­£å¼ä»£ç é‡Œé¢çš„å¯¹è±¡ï¼Œä½ å¿…é¡»è¦æœ‰æŸç§æ–¹å¼æŠŠmockå¯¹è±¡åº”ç”¨åˆ°æ­£å¼ä»£ç é‡Œé¢</strong></p>

<p>ç»“åˆä¸Šé¢çš„ä¾‹å­ï¼Œ<code>UserManager mockUserManager = Mockito.mock(UserManager.class);</code>çš„ç¡®ç»™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªmockå¯¹è±¡ï¼Œä¿å­˜åœ¨<code>mockUserManager</code>é‡Œé¢ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>loginPresenter.login("xiaochuang", "xiaochuang password");</code>çš„æ—¶å€™ï¼Œç”¨åˆ°çš„mUserManagerä¾ç„¶æ˜¯ä½¿ç”¨<code>new UserManager()</code>åˆ›å»ºçš„æ­£å¸¸çš„å¯¹è±¡ã€‚è€Œ<code>mockUserManager</code>å¹¶æ²¡æœ‰å¾—åˆ°ä»»ä½•çš„è°ƒç”¨ï¼Œå› æ­¤ï¼Œå½“æˆ‘ä»¬éªŒè¯å®ƒçš„<code>performLogin()</code>æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨æ—¶ï¼Œå°±å¤±è´¥äº†ã€‚</p>

<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨è°ƒç”¨<code>loginPresenter.login()</code>ä¹‹å‰ï¼ŒæŠŠ<code>mUserManager</code>å¼•ç”¨æ¢æˆ<code>mockUserManager</code>æ‰€å¼•ç”¨çš„mockå¯¹è±¡ã€‚æœ€ç®€å•çš„åŠæ³•ï¼Œå°±æ˜¯åŠ ä¸€ä¸ªsetterï¼š</p>

<pre><code class="language-java">public class LoginPresenter {

    private UserManager mUserManager = new UserManager();

    public void login(String username, String password) {
        if (username == null || username.length() == 0) return;
        if (password == null || password.length() &lt; 6) return;

        mUserManager.performLogin(username, password);
    }

    public void setUserManager(UserManager userManager) {  //&lt;==
        this.mUserManager = userManager;
    }

}
</code></pre>

<p>åŒæ—¶ï¼Œgetteræˆ‘ä»¬ç”¨ä¸åˆ°äº†ï¼Œäºæ˜¯è¿™é‡Œå°±ç›´æ¥åˆ äº†ã€‚é‚£ä¹ˆæŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œå†™å‡ºæ¥çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">@Test
public void testLogin() throws Exception {
    UserManager mockUserManager = Mockito.mock(UserManager.class);
    LoginPresenter loginPresenter = new LoginPresenter();
    loginPresenter.setUserManager(mockUserManager);  //&lt;==

    loginPresenter.login("xiaochuang", "xiaochuang password");

    Mockito.verify(mockUserManager).performLogin("xiaochuang", "xiaochuang password");
}
</code></pre>

<p>æœ€åè¿è¡Œä¸€æ¬¡ï¼Œhuã€‚ã€‚ã€‚ç»ˆäºé€šè¿‡äº†ï¼</p>

<p>å½“ç„¶ï¼Œå¦‚æœä½ çš„æ­£å¼ä»£ç é‡Œé¢æ²¡æœ‰ä»»ä½•åœ°æ–¹ç”¨åˆ°äº†é‚£ä¸ªsetterçš„è¯ï¼Œé‚£ä¹ˆä¸“é—¨ä¸ºäº†æµ‹è¯•è€Œå¢åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ¯•ç«Ÿä¸æ˜¯å¾ˆä¼˜é›…çš„è§£å†³åŠæ³•ï¼Œæ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œç®€å•è§£é‡Šå°±æ˜¯æŠŠ<code>UserManager</code>ä½œä¸º<code>LoginPresenter</code>çš„æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¼ è¿›å»ã€‚å…·ä½“æ“ä½œè¯·æœŸå¾…ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸“é—¨è®²mockçš„æ¦‚å¿µå’ŒMockitoçš„ä½¿ç”¨ã€‚</p>

<p>ç„¶è€Œè¿˜æ˜¯å¿ä¸ä½æƒ³å¤šå˜´ä¸€å¥ï¼š
ä¼˜é›…å½’ä¼˜é›…ï¼Œæœ‰æ²¡æœ‰å¿…è¦ï¼Œå€¼ä¸å€¼å¾—ï¼Œå´åˆæ˜¯å¦å¤–ä¸€å›äº‹ã€‚æ€»ä½“æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºæ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºè¿™å¯ä»¥è®©è¿™ä¸ªç±»å˜å¾—å¯æµ‹ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éªŒè¯è¿™ä¸ªç±»çš„æ­£ç¡®æ€§ï¼Œæ›´ç»™ä»¥åé‡æ„è¿™ä¸ªç±»æœ‰äº†ä¿éšœï¼Œé˜²æ­¢è¯¯æ”¹é”™è¿™ä¸ªç±»ç­‰ç­‰ã€‚å› æ­¤ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¦‚æœä½ ä¸ºäº†åšå•å…ƒæµ‹è¯•ï¼Œä¸å¾—å·²è¦ç»™ä¸€äº›ç±»åŠ ä¸€äº›é¢å¤–çš„ä»£ç ã€‚é‚£å°±åŠ å§ï¼æ¯•ç«Ÿä¼˜é›…ä¸èƒ½å½“é¥­åƒï¼Œè€Œè§£å†³é—®é¢˜ã€ä¿®å¤bugå¯ä»¥ï¼Œåšå‡ºä¼˜ç§€çš„ã€å°‘æœ‰bugçš„äº§å“æ›´å¯ä»¥ï¼Œæ‰€ä»¥ï¼ŒJust Do It!</p>

<p>å¥½äº†ï¼Œç°åœ¨æˆ‘æƒ³å¤§å®¶å¯¹mockçš„æ¦‚å¿µåº”è¯¥æœ‰äº†æ­£ç¡®çš„è®¤è¯†ï¼Œå¯¹æ€ä¹ˆæ ·ä½¿ç”¨mockä¹Ÿæœ‰äº†è®¤è¯†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å…¨å¿ƒå…¨æ„ä»‹ç»Mockitoçš„åŠŸèƒ½å’Œä½¿ç”¨äº†ã€‚</p>

<h3 id="mockitoçš„ä½¿ç”¨">Mockitoçš„ä½¿ç”¨</h3>

<h4 id="1-éªŒè¯æ–¹æ³•è°ƒç”¨">1. éªŒè¯æ–¹æ³•è°ƒç”¨</h4>

<p>å‰é¢æˆ‘ä»¬è®²äº†éªŒè¯ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªmethodå¾—åˆ°è°ƒç”¨çš„æ–¹æ³•ï¼š<br />
<code>Mockito.verify(mockUserManager).performLogin("xiaochuang", "xiaochuang password");</code><br />
è¿™å¥è¯çš„ä½œç”¨æ˜¯ï¼ŒéªŒè¯<code>mockUserManager</code>çš„<code>performLogin()</code>å¾—åˆ°äº†è°ƒç”¨ï¼ŒåŒæ—¶å‚æ•°æ˜¯â€œxiaochuangâ€å’Œâ€xiaochuang passwordâ€ã€‚å…¶å®æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼Œè¿™è¡Œä»£ç éªŒè¯çš„æ˜¯ï¼Œ<code>mockUserManager</code>çš„<code>performLogin()</code>æ–¹æ³•å¾—åˆ°äº†<strong>ä¸€æ¬¡</strong>è°ƒç”¨ã€‚å› ä¸ºè¿™è¡Œä»£ç å…¶å®æ˜¯ï¼š<br />
<code>Mockito.verify(mockUserManager, Mockito.times(1)).performLogin("xiaochuang", "xiaochuang password");</code><br />
çš„ç®€å†™ï¼Œæˆ–è€…è¯´é‡è½½æ–¹æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„<code>Mockito.times(1)</code>ã€‚<br />
å› æ­¤ï¼Œå¦‚æœä½ æƒ³éªŒè¯ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ–¹æ³•å¾—åˆ°äº†å¤šæ¬¡è°ƒç”¨ï¼Œåªéœ€è¦å°†æ¬¡æ•°ä¼ ç»™<code>Mockito.times()</code>å°±å¥½äº†ã€‚<br />
<code>Mockito.verify(mockUserManager, Mockito.times(3)).performLogin(...); //éªŒè¯mockUserManagerçš„performLoginå¾—åˆ°äº†ä¸‰æ¬¡è°ƒç”¨ã€‚</code></p>

<p>å¯¹äºè°ƒç”¨æ¬¡æ•°çš„éªŒè¯ï¼Œé™¤äº†å¯ä»¥éªŒè¯å›ºå®šçš„å¤šå°‘æ¬¡ï¼Œè¿˜å¯ä»¥éªŒè¯æœ€å¤šï¼Œæœ€å°‘ä»æ¥æ²¡æœ‰ç­‰ç­‰ï¼Œæ–¹æ³•åˆ†åˆ«æ˜¯ï¼š<code>atMost(count), atLeast(count), never()</code>ç­‰ç­‰ï¼Œéƒ½æ˜¯Mockitoçš„é™æ€æ–¹æ³•ï¼Œå…¶å®å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬ä¼šstatic import Mockitoè¿™ä¸ªç±»çš„æ‰€æœ‰é™æ€æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡åŠ ä¸Š<code>Mockito.</code>å‰ç¼€äº†ã€‚æœ¬æ–‡ä¸‹é¢æˆ‘ä¹ŸæŒ‰ç…§è¿™ä¸ªè§„åˆ™ã€‚ï¼ˆå…¶å®æˆ‘æ—©å°±æƒ³è¯´è¿™å¥è¯å•¦ï¼Œåªæ˜¯ä¸€ç›´æ²¡æ‰¾åˆ°å¥½çš„æ—¶æœº[å–œæè€Œæ³£]ï¼‰</p>

<p>å¾ˆå¤šæ—¶å€™ä½ å¹¶ä¸å…³å¿ƒè¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°å…·ä½“æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…æ˜¯ä½ ä¹Ÿä¸çŸ¥é“ï¼Œä½ åªå…³å¿ƒè¿™ä¸ªæ–¹æ³•å¾—åˆ°è°ƒç”¨äº†å°±è¡Œã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒMockitoæä¾›äº†ä¸€ç³»åˆ—çš„<code>any</code>æ–¹æ³•ï¼Œæ¥è¡¨ç¤ºä»»ä½•çš„å‚æ•°éƒ½è¡Œï¼š<br />
<code>Mockito.verify(mockUserManager).performLogin(Mockito.anyString(), Mockito.anyString());</code><br />
<code>anyString()</code>è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½å¯ä»¥ã€‚nullï¼Ÿä¹Ÿå¯ä»¥çš„ï¼<br />
ç±»ä¼¼<code>anyString</code>ï¼Œè¿˜æœ‰<code>anyInt, anyLong, anyDouble</code>ç­‰ç­‰ã€‚<code>anyObject</code>è¡¨ç¤ºä»»ä½•å¯¹è±¡ï¼Œ<code>any(clazz)</code>è¡¨ç¤ºä»»ä½•å±äºclazzçš„å¯¹è±¡ã€‚åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘åˆšåˆšå‘ç°ï¼Œè¿˜æœ‰éå¸¸æœ‰æ„æ€ä¹Ÿéå¸¸äººæ€§åŒ–çš„<code>anyCollectionï¼ŒanyCollectionOf(clazz), anyList(Map, set), anyListOf(clazz)</code>ç­‰ç­‰ã€‚çœ‹æ¥æˆ‘ä¹‹å‰å†™äº†ä¸å°‘å†¤æ‰ä»£ç å•ŠT_Tã€‚ã€‚ã€‚</p>

<h4 id="2-æŒ‡å®šmockå¯¹è±¡çš„æŸäº›æ–¹æ³•çš„è¡Œä¸º">2. æŒ‡å®šmockå¯¹è±¡çš„æŸäº›æ–¹æ³•çš„è¡Œä¸º</h4>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†mockçš„ä¸€å¤§ä½œç”¨ï¼šéªŒè¯æ–¹æ³•è°ƒç”¨ã€‚æˆ‘ä»¬è¯´mockä¸»è¦æœ‰ä¸¤å¤§ä½œç”¨ï¼Œç¬¬äºŒä¸ªå¤§ä½œç”¨æ˜¯ï¼šæŒ‡å®šæŸä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œã€‚</p>

<p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»mockçš„ç¬¬äºŒå¤§ä½œç”¨ï¼Œå…ˆä»‹ç»å…¶ä¸­çš„ç¬¬ä¸€ç‚¹ï¼šæŒ‡å®šmockå¯¹è±¡çš„æŸä¸ªæ–¹æ³•è¿”å›ç‰¹å®šçš„å€¼ã€‚<br />
ç°åœ¨å‡è®¾æˆ‘ä»¬ä¸Šé¢çš„<code>LoginPresenter</code>çš„<code>login</code>æ–¹æ³•æ˜¯å¦‚ä¸‹å®ç°çš„ï¼š</p>

<pre><code class="language-java">public void login(String username, String password) {
    if (username == null || username.length() == 0) return;
    //å‡è®¾æˆ‘ä»¬å¯¹å¯†ç å¼ºåº¦æœ‰ä¸€å®šè¦æ±‚ï¼Œä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„validatoræ¥éªŒè¯å¯†ç çš„æœ‰æ•ˆæ€§
    if (mPasswordValidator.verifyPassword(password)) return;  //&lt;==

    mUserManager.performLogin(null, password);
}
</code></pre>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸ª<code>PasswordValidator</code>æ¥éªŒè¯å¯†ç çš„æœ‰æ•ˆæ€§ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„<code>verifyPassword()</code>æ–¹æ³•è¿è¡Œéœ€è¦å¾ˆä¹…ï¼Œæ¯”å¦‚è¯´éœ€è¦è”ç½‘ã€‚è¿™ä¸ªæ—¶å€™åœ¨æµ‹è¯•çš„ç¯å¢ƒä¸‹æˆ‘ä»¬æƒ³ç®€å•å¤„ç†ï¼ŒæŒ‡å®šè®©å®ƒç›´æ¥è¿”å›trueæˆ–falseã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™æ ·åšå¯ä»¥å—ï¼ŸçœŸçš„å¥½å—ï¼Ÿå›ç­”æ˜¯è‚¯å®šçš„ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬è¦æµ‹çš„æ˜¯<code>login()</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™å…¶å®è·Ÿ<code>PasswordValidator</code>å†…éƒ¨çš„é€»è¾‘æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œè¿™æ‰æ˜¯å•å…ƒæµ‹è¯•çœŸæ­£è¯¥æœ‰çš„ç²’åº¦ã€‚<br />
è¯è¯´å›æ¥ï¼Œè¿™ç§æŒ‡å®šmockå¯¹è±¡çš„æŸä¸ªæ–¹æ³•ï¼Œè®©å®ƒè¿”å›ç‰¹å®šå€¼çš„å†™æ³•å¦‚ä¸‹ï¼š
<code>Mockito.when(mockObject.targetMethod(args)).thenReturn(desiredReturnValue);</code><br />
åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œç»“åˆä¸Šé¢PasswordValidatorçš„ä¾‹å­ï¼š</p>

<pre><code class="language-java">//å…ˆåˆ›å»ºä¸€ä¸ªmockå¯¹è±¡
PasswordValidator mockValidator = Mockito.mock(PasswordValidator.class);

//å½“è°ƒç”¨mockValidatorçš„verifyPasswordæ–¹æ³•ï¼ŒåŒæ—¶ä¼ å…¥"xiaochuang_is_handsome"æ—¶ï¼Œè¿”å›true
Mockito.when(mockValidator.verifyPassword("xiaochuang_is_handsome")).thenReturn(true);

//å½“è°ƒç”¨mockValidatorçš„verifyPasswordæ–¹æ³•ï¼ŒåŒæ—¶ä¼ å…¥"xiaochuang_is_not_handsome"æ—¶ï¼Œè¿”å›false
Mockito.when(validator.verifyPassword("xiaochuang_is_not_handsome")).thenReturn(false);
</code></pre>

<p>åŒæ ·çš„ï¼Œä½ å¯ä»¥ç”¨<code>any</code>ç³»åˆ—æ–¹æ³•æ¥æŒ‡å®šâ€æ— è®ºä¼ å…¥ä»»ä½•å‚æ•°å€¼ï¼Œéƒ½è¿”å›xxxâ€ï¼š</p>

<pre><code class="language-java">//å½“è°ƒç”¨mockValidatorçš„verifyPasswordæ–¹æ³•æ—¶ï¼Œè¿”å›trueï¼Œæ— è®ºå‚æ•°æ˜¯ä»€ä¹ˆ
Mockito.when(validator.verifyPassword(anyString())).thenReturn(true);
</code></pre>

<p>æŒ‡å®šæ–¹æ³•è¿”å›ç‰¹å®šå€¼å°±ä»‹ç»åˆ°è¿™ï¼Œæ›´è¯¦ç»†æ›´é«˜çº§çš„ç”¨æ³•å¤§å®¶å¯ä»¥è‡ªå·±googleã€‚æ¥ä¸‹æ¥ä»‹ç»ï¼Œæ€ä¹ˆæ ·æŒ‡å®šä¸€ä¸ªæ–¹æ³•æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œï¼Œè¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬æ˜¯ç”¨åœ¨ç›®æ ‡çš„æ–¹æ³•æ˜¯voidç±»å‹çš„æ—¶å€™ã€‚<br />
ç°åœ¨å‡è®¾æˆ‘ä»¬çš„<code>LoginPresenter</code>çš„<code>login()</code>æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code class="language-java">public void loginCallbackVersion(String username, String password) {
    if (username == null || username.length() == 0) return;
    //å‡è®¾æˆ‘ä»¬å¯¹å¯†ç å¼ºåº¦æœ‰ä¸€å®šè¦æ±‚ï¼Œä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„validatoræ¥éªŒè¯å¯†ç çš„æœ‰æ•ˆæ€§
    if (mPasswordValidator.verifyPassword(password)) return;

    //loginçš„ç»“æœå°†é€šè¿‡callbackä¼ é€’å›æ¥ã€‚
    mUserManager.performLogin(username, password, new NetworkCallback() {  //&lt;==
        @Override
        public void onSuccess(Object data) {
            //update view with data
        }

        @Override
        public void onFailure(int code, String msg) {
            //show error msg
        }
    });
}
</code></pre>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æƒ³è¿›ä¸€æ­¥æµ‹è¯•ä¼ ç»™<code>mUserManager.performLogin</code>çš„<code>NetworkCallback</code>é‡Œé¢çš„ä»£ç ï¼ŒéªŒè¯viewå¾—åˆ°äº†æ›´æ–°ç­‰ç­‰ã€‚åœ¨æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³ä¾èµ–<code>mUserManager.performLogin</code>çš„çœŸå®é€»è¾‘ï¼Œè€Œæ˜¯è®©<code>mUserManager</code>ç›´æ¥è°ƒç”¨ä¼ å…¥çš„<code>NetworkCallback</code>çš„<code>onSuccess</code>æˆ–<code>onFailure</code>æ–¹æ³•ã€‚è¿™ç§æŒ‡å®šmockå¯¹è±¡æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œçš„å†™æ³•å¦‚ä¸‹ï¼š<br />
<code>Mockito.doAnswer(desiredAnswer).when(mockObject).targetMethod(args);</code><br />
ä¼ ç»™<code>doAnswer()</code>çš„æ˜¯ä¸€ä¸ª<code>Answer</code>å¯¹è±¡ï¼Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„åŠ¨ä½œï¼Œå°±åœ¨è¿™é‡Œé¢å®ç°ã€‚ç»“åˆä¸Šé¢çš„ä¾‹å­è§£é‡Šï¼š</p>

<pre><code class="language-java"> Mockito.doAnswer(new Answer() {
    @Override
    public Object answer(InvocationOnMock invocation) throws Throwable {
        //è¿™é‡Œå¯ä»¥è·å¾—ä¼ ç»™performLoginçš„å‚æ•°
        Object[] arguments = invocation.getArguments();

        //callbackæ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°
        NetworkCallback callback = (NetworkCallback) arguments[2];

        callback.onFailure(500, "Server error");
        return 500;
    }
}).when(mockUserManager).performLogin(anyString(), anyString(), any(NetworkCallback.class));
</code></pre>

<p>è¿™é‡Œï¼Œå½“è°ƒç”¨<code>mockUserManager</code>çš„<code>performLogin</code>æ–¹æ³•æ—¶ï¼Œä¼šæ‰§è¡Œansweré‡Œé¢çš„ä»£ç ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­æ˜¯ç›´æ¥è°ƒç”¨ä¼ å…¥çš„<code>callback</code>çš„<code>onFailure</code>æ–¹æ³•ï¼ŒåŒæ—¶ä¼ ç»™<code>onFailure</code>æ–¹æ³•500å’Œâ€Server errorâ€ã€‚</p>

<p>å½“ç„¶ï¼Œä½¿ç”¨<code>Mockito.doAnswer()</code>éœ€è¦åˆ›å»ºä¸€ä¸ªAnswerå¯¹è±¡ï¼Œè¿™æœ‰ç‚¹éº»çƒ¦ï¼Œä»£ç çœ‹èµ·æ¥ä¹Ÿç¹çï¼Œå¦‚æœæƒ³ç®€å•çš„æŒ‡å®šç›®æ ‡æ–¹æ³•â€œä»€ä¹ˆéƒ½ä¸åšâ€ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>Mockito.doNothing()</code>ã€‚å¦‚æœæƒ³æŒ‡å®šç›®æ ‡æ–¹æ³•â€œæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸â€ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>Mockito.doThrow(desiredException)</code>ã€‚å¦‚æœä½ æƒ³è®©ç›®æ ‡æ–¹æ³•è°ƒç”¨çœŸå®çš„é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨<code>Mockito.doCallRealMethod()</code>ã€‚ï¼ˆä»€ä¹ˆ??? é»˜è®¤ä¸æ˜¯ä¼šè¿™æ ·å—ï¼Ÿ?? No! ï¼‰</p>

<h3 id="spy">Spy</h3>

<p>æœ€åä»‹ç»ä¸€ä¸ªSpyçš„ä¸œè¥¿ã€‚å‰é¢æˆ‘ä»¬è®²äº†mockå¯¹è±¡çš„ä¸¤å¤§åŠŸèƒ½ï¼Œå¯¹äºç¬¬äºŒå¤§åŠŸèƒ½: æŒ‡å®šæ–¹æ³•çš„ç‰¹å®šè¡Œä¸ºï¼Œä¸çŸ¥é“ä½ ä¼šä¸ä¼šå¥½å¥‡ï¼Œå¦‚æœæˆ‘ä¸æŒ‡å®šçš„è¯ï¼Œå®ƒä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿé‚£ä¹ˆç°åœ¨è¡¥å……ä¸€ä¸‹ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œä¸€ä¸ªmockå¯¹è±¡çš„æ‰€æœ‰évoidæ–¹æ³•éƒ½å°†è¿”å›é»˜è®¤å€¼ï¼šintã€longç±»å‹æ–¹æ³•å°†è¿”å›0ï¼Œbooleanæ–¹æ³•å°†è¿”å›falseï¼Œå¯¹è±¡æ–¹æ³•å°†è¿”å›nullç­‰ç­‰ï¼›è€Œvoidæ–¹æ³•å°†ä»€ä¹ˆéƒ½ä¸åšã€‚<br />
ç„¶è€Œå¾ˆå¤šæ—¶å€™ï¼Œä½ å¸Œæœ›è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼šé™¤éæŒ‡å®šï¼Œå¦è€…è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„é»˜è®¤å®ç°ï¼ŒåŒæ—¶åˆèƒ½æ‹¥æœ‰éªŒè¯æ–¹æ³•è°ƒç”¨çš„åŠŸèƒ½ã€‚è¿™æ­£å¥½æ˜¯spyå¯¹è±¡æ‰€èƒ½å®ç°çš„æ•ˆæœã€‚åˆ›å»ºä¸€ä¸ªspyå¯¹è±¡ï¼Œä»¥åŠspyå¯¹è±¡çš„ç”¨æ³•ä»‹ç»å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">//å‡è®¾ç›®æ ‡ç±»çš„å®ç°æ˜¯è¿™æ ·çš„
public class PasswordValidator {
    public boolean verifyPassword(String password) {
        return "xiaochuang_is_handsome".equals(password);
    }
}

@Test
public void testSpy() {
    //è·Ÿåˆ›å»ºmockç±»ä¼¼ï¼Œåªä¸è¿‡è°ƒç”¨çš„æ˜¯spyæ–¹æ³•ï¼Œè€Œä¸æ˜¯mockæ–¹æ³•ã€‚spyçš„ç”¨æ³•
    PasswordValidator spyValidator = Mockito.spy(PasswordValidator.class);

    //åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œspyå¯¹è±¡ä¼šè°ƒç”¨è¿™ä¸ªç±»çš„çœŸå®é€»è¾‘ï¼Œå¹¶è¿”å›ç›¸åº”çš„è¿”å›å€¼ï¼Œè¿™å¯ä»¥å¯¹ç…§ä¸Šé¢çš„çœŸå®é€»è¾‘
    spyValidator.verifyPassword("xiaochuang_is_handsome"); //true
    spyValidator.verifyPassword("xiaochuang_is_not_handsome"); //false

    //spyå¯¹è±¡çš„æ–¹æ³•ä¹Ÿå¯ä»¥æŒ‡å®šç‰¹å®šçš„è¡Œä¸º
    Mockito.when(spyValidator.verifyPassword(anyString())).thenReturn(true);

    //åŒæ ·çš„ï¼Œå¯ä»¥éªŒè¯spyå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æƒ…å†µ
    spyValidator.verifyPassword("xiaochuang_is_handsome");
    Mockito.verify(spyValidator).verifyPassword("xiaochuang_is_handsome"); //pass
}
</code></pre>

<p>æ€»ä¹‹ï¼Œspyä¸mockçš„å”¯ä¸€åŒºåˆ«å°±æ˜¯é»˜è®¤è¡Œä¸ºä¸ä¸€æ ·ï¼šspyå¯¹è±¡çš„æ–¹æ³•é»˜è®¤è°ƒç”¨çœŸå®çš„é€»è¾‘ï¼Œmockå¯¹è±¡çš„æ–¹æ³•é»˜è®¤ä»€ä¹ˆéƒ½ä¸åšï¼Œæˆ–ç›´æ¥è¿”å›é»˜è®¤å€¼ã€‚</p>

<h3 id="å°ç»“">å°ç»“</h3>
<p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†mockçš„æ¦‚å¿µä»¥åŠMockitoçš„ä½¿ç”¨ï¼Œå¯èƒ½Mockitoçš„å¾ˆå¤šçš„ä¸€äº›å…¶ä»–æ–¹æ³•æ²¡æœ‰ä»‹ç»ï¼Œä½†è¿™åªæ˜¯é˜…è¯»æ–‡æ¡£çš„é—®é¢˜è€Œå·²ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£mockçš„æ¦‚å¿µã€‚
å¦‚æœä½ æƒ³äº†è§£Mockitoæ›´è¯¦ç»†çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href="http://www.vogella.com/tutorials/Mockito/article.html">è¿™ç¯‡æ–‡ç« </a>ï¼Œå†™çš„æ˜¯ç›¸å½“çš„å¥½ã€‚</p>

<p>ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°†ä»‹ç»ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µï¼Œä»¥åŠï¼ˆæˆ–è®¸ï¼‰ä½¿ç”¨dagger2æ¥æ›´æ–¹ä¾¿çš„åšä¾èµ–æ³¨å…¥ï¼Œä»¥åŠåœ¨å•å…ƒæµ‹è¯•é‡Œé¢çš„åº”ç”¨ï¼Œè¿™é‡Œä¾ç„¶åå¾ˆå¤šçš„è¯¯åŒºï¼Œéœ€è¦å¤§å®¶æ³¨æ„çš„ï¼Œæƒ³çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆå—ï¼Ÿé‚£å°±<br />
Stay tunedï¼</p>

<p>æ–‡ä¸­ä»£ç åœ¨<a href="https://github.com/ChrisZou/android-unit-testing-tutorial">Github</a><br />
æœ€åï¼Œå¦‚æœä½ å¯¹å®‰å“å•å…ƒæµ‹è¯•æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„äº¤æµç¾¤ï¼Œå› ä¸ºç¾¤æˆå‘˜è¶…è¿‡100äººï¼Œæ²¡åŠæ³•æ‰«ç åŠ å…¥ï¼Œè¯·å…³æ³¨ä¸‹æ–¹å…¬ä¼—å·è·å–åŠ å…¥æ–¹æ³•ã€‚</p>
:ET